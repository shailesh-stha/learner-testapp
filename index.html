<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>German Learning Library</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: #121212;
            color: #eeeeee;
            margin: 0;
            padding: 20px;
        }
        .container {
            width: auto;
            max-width: 700px;
            margin: 0 auto;
            background: #1e1e1e;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            overflow: hidden;
        }
        h1 {
            padding: 25px 25px 10px;
            margin: 0;
            font-size: 1.8em;
            color: #ffffff;
        }
        ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        li a {
            display: block;
            padding: 18px 25px;
            text-decoration: none;
            color: #eeeeee;
            font-size: 1.1em;
            border-top: 1px solid #333;
            transition: background-color 0.2s;
        }
        li a:hover {
            background-color: #2c2c2c;
        }
        /* Style for the loading/no lessons message */
        li.status-message {
            padding: 18px 25px;
            color: #888;
            font-style: italic;
            border-top: 1px solid #333;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>German Learning Library</h1>
        
        <ul id="lesson-list">
            <li class="status-message">Loading lessons...</li>
        </ul>
    </div>

    <script>
        // This script runs when the page loads
        window.addEventListener('DOMContentLoaded', () => {
            const lessonList = document.getElementById('lesson-list');
            
            // This function will check if a file exists
            // We use 'HEAD' to check the file header, not download the whole file
            async function fileExists(url) {
                try {
                    const response = await fetch(url, { method: 'HEAD' });
                    return response.ok; // Returns true if file exists (status 200)
                } catch (error) {
                    return false; // Returns false if network error or file not found
                }
            }

            // This async function will loop and find all lessons
            async function findLessons() {
                let n = 1;
                let keepLooking = true;
                let lessonsFound = 0;

                while (keepLooking) {
                    const transcriptUrl = `transcript_${n}.txt`;
                    const audioUrl = `audio_${n}.mp3`;

                    // Check if *both* files exist for this lesson number
                    const [transcriptFound, audioFound] = await Promise.all([
                        fileExists(transcriptUrl),
                        fileExists(audioUrl)
                    ]);

                    if (transcriptFound && audioFound) {
                        // --- Both files found! ---
                        
                        // Clear the "Loading..." message on the first find
                        if (lessonsFound === 0) {
                            lessonList.innerHTML = ''; 
                        }
                        
                        // Create the new list item and link
                        const li = document.createElement('li');
                        li.innerHTML = `<a href="player.html?lesson=${n}">Lesson ${n}: Transcript ${n}</a>`;
                        lessonList.appendChild(li);
                        
                        lessonsFound++;
                        n++; // Look for the next lesson (lesson_2, lesson_3...)
                    } else {
                        // --- A file was missing ---
                        keepLooking = false; // Stop the loop
                    }
                }

                // If after checking, no lessons were found at all
                if (lessonsFound === 0) {
                    lessonList.innerHTML = '<li class="status-message">No lessons found. Add `audio_1.mp3` and `transcript_1.txt` to start.</li>';
                }
            }

            // Start the search!
            findLessons();
        });
    </script>

</body>
</html>