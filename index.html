<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>German Learning Library</title>
    <link rel="stylesheet" href="style.css">
</head>
<body id="page-index">

    <header>
        <h1><a href="index.html">German Learning Library</a></h1>
    </header>

    <div class="container">
        <ul id="lesson-list">
            <li class="status-message">Loading lessons...</li>
        </ul>
    </div>
    
    <script>
        // This script runs when the page loads
        window.addEventListener('DOMContentLoaded', () => {
            const lessonList = document.getElementById('lesson-list');
            
            // This function will check if a file exists
            // We use 'HEAD' to check the file header, not download the whole file
            async function fileExists(url) {
                try {
                    const response = await fetch(url, { method: 'HEAD' });
                    return response.ok; // Returns true if file exists (status 200)
                } catch (error) {
                    return false; // Returns false if network error or file not found
                }
            }

            // This async function will loop and find all lessons
            async function findLessons() {
                let n = 1;
                let keepLooking = true;
                let lessonsFound = 0;

                while (keepLooking) {
                    const transcriptUrl = `transcript_${n}.txt`;
                    const audioUrl = `audio_${n}.mp3`;

                    // Check if *both* files exist for this lesson number
                    const [transcriptFound, audioFound] = await Promise.all([
                        fileExists(transcriptUrl),
                        fileExists(audioUrl)
                    ]);

                    if (transcriptFound && audioFound) {
                        // --- Both files found! ---
                        
                        // Clear the "Loading..." message on the first find
                        if (lessonsFound === 0) {
                            lessonList.innerHTML = ''; 
                        }
                        
                        // Create the new list item and link
                        const li = document.createElement('li');
                        li.innerHTML = `<a href="player.html?lesson=${n}">Lesson ${n}: Transcript ${n}</a>`;
                        lessonList.appendChild(li);
                        
                        lessonsFound++;
                        n++; // Look for the next lesson (lesson_2, lesson_3...)
                    } else {
                        // --- A file was missing ---
                        keepLooking = false; // Stop the loop
                    }
                }

                // If after checking, no lessons were found at all
                if (lessonsFound === 0) {
                    lessonList.innerHTML = '<li class="status-message">No lessons found. Add `audio_1.mp3` and `transcript_1.txt` to start.</li>';
                }
            }

            // Start the search!
            findLessons();
        });
    </script>

</body>
</html>